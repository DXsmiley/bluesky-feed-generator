generator client {
  provider = "prisma-client-py"
  interface = "asyncio"
  recursive_type_depth = -1
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://paf:password@localhost:5432/foxfeed"
}

model SubscriptionState {
  service String @id
  cursor Int
}

model Actor {
  did String @id
  handle String
  description String?
  displayName String?
  in_fox_feed Boolean
  in_vix_feed Boolean
  gender_label_auto String @default("unknown")
  gender_label_manual String @default("not-looked-at")
  posts Post[]
  likes Like[]
}

model Post {
  uri String @id
  cid String
  reply_parent String?
  reply_root String?
  indexed_at DateTime @default(now())
  like_count Int @default(0)
  text String
  mentions_fursuit Boolean
  media_count Int
  media_with_alt_text_count Int @default(0)
  authorId String
  author Actor @relation(fields: [authorId], references: [did], onDelete: Cascade)
  likes Like[]
  // Media URLs
  m0 String?
  m1 String?
  m2 String?
  m3 String?
  @@index([uri])
  @@index([indexed_at])
}

model Like {
  uri String @id
  cid String // do I even need this?
  liker_id String
  liker Actor @relation(fields: [liker_id], references: [did], onDelete: Cascade)
  post_uri String
  post Post @relation(fields: [post_uri], references: [uri], onDelete: Cascade)
  post_cid String
  created_at DateTime
  counter Int @default(1)
  @@index([post_uri])
  @@index([created_at])
}

model PostScore {
  uri String
  version Int
  feed_name String
  score Float
  created_at DateTime
  @@id([feed_name, version, uri])
  @@index([feed_name, version, score(sort: Desc)])
  @@index([created_at])
}
